ZZRGUT ; UNIT TESTS
 I $T(EN^XTMUNIT)'="" D EN^XTMUNIT("ZZRGUT")
 Q
 ;
STARTUP
 N GMPIFN
 S DTIME=500 ;D INIT^GMPLMGR
 S DUZ=1
 S GMPDFN=1
 S GMPROV=1
 S DT=$P($$HTFM^XLFDT($H),".")
 S GMPVAMC=2956
 S U="^"
 Q
 ;
GETPLIST
 N GMPLIST,GMPTOTAL,GMPLVIEW,GMPDFN
 S GMPDFN="2^CARTER, DAVID J SR^C0112"
 S GMPLVIEW("ACT")="A"
 S GMPLVIEW("PROV")=0
 S GMPLVIEW("VIEW")=""
 S GMPARAM("VER")=1
 S GMPARAM("PRT")=1
 S GMPARAM("CLU")=1
 S GMPARAM("REV")=0
 S GMPARAM("QUIET")=1
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
 D CHKEQ^XTMUNIT(GMPLIST(0),0,"GETPLIST^GMPLMGR1: Patient David Carter Sr., GMPLIST(0)'=0")
 S GMPDFN="1^CARTER, DAVID J JR^C0111"
 K GMPLIST,GMPTOTAL
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW) 
 D CHKTF^XTMUNIT(GMPLIST(0)'=0,"GETPLIST^GMPLMGR1: Patient David Carter Jr., GMPLIST(0)=0")
 Q
 ;
NEWPROB
 N G,GMPFLD,GMPDFN,GMPVAMC,DT,RETURN,GMPROV
 S GMPVAMC=2956
 S GMPDFN=2
 S DT=2
 S GMPROV=30
 S G(.01)="GMPFLD(.01)=13154"
 S G(.02)="GMPFLD(.02)=1"
 S G(.03)="GMPFLD(.03)=3120220"
 S G(.04)="GMPFLD(.04)=""P"""
 S G(.05)="GMPFLD(.05)=""^Obesity in Diabetes"""
 S G(.06)="GMPFLD(.06)="_GMPVAMC
 ;3
 S G(.08)="GMPFLD(.08)=3120220"
 S G(.12)="GMPFLD(.12)=""A"""
 S G(.13)="GMPFLD(.13)=3120220"
 S G(1.01)="GMPFLD(1.01)=84838"
 S G(1.03)="GMPFLD(1.03)=30"
 S G(1.08)="GMPFLD(1.08)=4"
 ;^30^30^^^4^3120220^0^0^0^0^A^0^0^0^0"
 D ADDSAVE^ORQQPL1(.RETURN,GMPDFN,GMPROV,GMPVAMC,.G)
 D CHKTF^XTMUNIT(RETURN>0,"NEW^GMPLSAVE: save failed")
 Q
 ;
API2NEW
 N GMPFLD,GMPERR,NUM
 S GMPFLD(.01)="872^253.2"
 S GMPFLD(.05)="^Hypopituitarism (Diabetes Insipidus)"
 S GMPFLD(.08)="3120306^3/6/12"
 S GMPFLD(.12)="A^ACTIVE"
 S GMPFLD(.13)="3120101^1/1/12"
 S GMPFLD(1.01)="304837^Hypopituitarism (Diabetes Insipidus)"
 S GMPFLD(1.02)="P"
 S GMPFLD(1.03)=1
 S GMPFLD(1.04)="1^TESTMASTER,USER"
 S GMPFLD(1.05)="1^TESTMASTER,USER"
 S GMPFLD(1.06)=""
 S GMPFLD(1.07)=""
 S GMPFLD(1.08)="4^CLINIC"
 S GMPFLD(1.09)="3120306^3/6/12"
 S GMPFLD(1.1)="0^NO"
 S GMPFLD(1.11)="0^NO"
 S GMPFLD(1.12)="0^NO"
 S GMPFLD(1.13)="0^NO"
 S GMPFLD(1.14)="A^ACUTE"
 S GMPFLD(10,0)=0
 S GMPFLD(10,"NEW",1)="TEST COMMENT"
 S GMPIFN=$$NEW^GMPLAPI2(GMPDFN,GMPROV,GMPVAMC,.GMPFLD,"GMPERR")
 I GMPIFN'>0 D FAIL^XTMUNIT("Save failed.") Q
 S NUM=$$NEXTNMBR^GMPLSAVE(GMPDFN,GMPVAMC)-1
 D CHKEQ^XTMUNIT($G(^AUPNPROB(GMPIFN,0)),"872^1^"_DT_"^^7^"_GMPVAMC_"^"_NUM_"^"_DT_"^^^^A^3120101","Invalid data line 0. IFN: "_$G(GMPIFN))
 D CHKEQ^XTMUNIT($G(^AUPNPROB(GMPIFN,1)),"304837^P^1^1^1^^^4^3120306^0^0^0^0^A^^^^","Invalid data line 1. IFN: "_$G(GMPIFN,1))
 D CHKEQ^XTMUNIT($G(^AUPNPROB(GMPIFN,11,0)),"^9000011.11PA^1^1","Note facility not saved. IFN: "_$G(GMPIFN,1))
 D CHKTF^XTMUNIT($D(^AUPNPROB(GMPIFN,11,"B",GMPVAMC,1)),"Note facility index not created. IFN: "_$G(GMPIFN,1))
 D CHKEQ^XTMUNIT($G(^AUPNPROB(GMPIFN,11,1,11,0)),"^9000011.1111IA^1^1","Note file empty. IFN: "_$G(GMPIFN,1))
 D CHKEQ^XTMUNIT($G(^AUPNPROB(GMPIFN,11,1,11,1,0)),"1^^TEST COMMENT^A^"_DT_"^1","Invalid note: "_$G(^AUPNPROB(GMPIFN,11,1,11,1,0)))
 D CHKTF^XTMUNIT($D(^AUPNPROB(GMPIFN,11,1,11,"B",1,1)),"Note index not created. IFN: "_$G(GMPIFN,1))
 D CHKTF^XTMUNIT($D(^AUPNPROB("C",304837,GMPIFN)),"C index not updated. IFN: "_$G(GMPIFN,1))
 D CHKTF^XTMUNIT($D(^AUPNPROB("ACTIVE",1,"A",GMPIFN)),"A index not updated. IFN: "_$G(GMPIFN,1))
 D CHKTF^XTMUNIT($D(^AUPNPROB("AC",1,GMPIFN)),"AC index not updated. IFN: "_$G(GMPIFN,1))
 D CHKTF^XTMUNIT($D(^AUPNPROB("B",872,GMPIFN)),"B index not updated. IFN: "_$G(GMPIFN,1))
 Q
 ;
API2DEL
 N OK,NOTENMBR
 K GMPERR
 S OK=$$DELETE^GMPLAPI2(GMPIFN,GMPROV,GMPVAMC,"DELETE TESTS","GMPERR")
 D CHKTF^XTMUNIT(OK,$G(GMPERR(1)))
 D CHKEQ^XTMUNIT("H",$P($G(^AUPNPROB(GMPIFN,1)),U,2),"Record not marked as deleted")
 S NOTENMBR=$P($G(^AUPNPROB(GMPIFN,11,1,11,0)),U,4)
 D CHKEQ^XTMUNIT("DELETE TESTS",$P($G(^AUPNPROB(GMPIFN,11,1,11,NOTENMBR,0)),U,3),"Delete note not saved")
 S OK=$$DELETE^GMPLAPI2(GMPIFN,GMPROV,GMPVAMC,"DELETE TESTS","GMPERR") ; Should fail with 'Already deleted'
 D CHKTF^XTMUNIT('OK,"Deleted twice")
 Q
 ;
XTENT
 ;;API2NEW
 ;;API2DEL
 ;;GETPLIST
 Q
 ;
